@using TeamManager.Manual.Data
@using System.Linq
@model IList<RaceViewModel>
@{
    ViewBag.Title = "Races";
}

<h1>Races</h1>
<a asp-action="Add" class="btn btn-primary btn-sm">+ New</a>

@if (Model == null || Model.Count == 0)
{
    <h5>No races in the database.</h5>
}
else
{
    <div class="m-3">
        <table class="table">
            <tr>
                <th>Date</th>
                <th>Race name</th>
                <th>Type</th>
                <th>City</th>
                <th>Distances</th>
                <th>Entry deadline</th>
                <th>Website</th>
                <th>Points</th>
            </tr>
            @foreach (var race in Model)
            {
                <tr>
                    <td>@race.Date?.ToString("yyyy.MM.dd")</td>
                    <td>@race.Name</td>
                    <td>@(race.TypeOfRace.HasValue ? EnumHelper<RaceType>.GetDisplayValue(race.TypeOfRace.Value) : "")
                    </td>
                    <td>
                        @{
                            string cityString = race.City;
                            if (!string.IsNullOrWhiteSpace(race.Country))
                            {
                                cityString += $" ({race.Country})";
                            }
                        }
                        @cityString
                    </td>
                    <td>
                        @{
                            string distancesString = null;
                            for (int i = 0; i < race.Distances.Count; i++)
                            {
                                distancesString += i == race.Distances.Count - 1 ? race.Distances[i] + " km " : race.Distances[i] + " km, ";
                            }
                        }
                        @distancesString
                    </td>
                    <td>@race.EntryDeadline?.ToString("yyyy.MM.dd HH:mm")</td>
                    <td>
                        @if (!string.IsNullOrWhiteSpace(race.Website))
                        {
                            <a href="@race.Website" target="_blank">here</a>
                        }
                    </td>
                    <td>@race.PointWeight</td>
                </tr>
            }
        </table>
    </div>
}
<a asp-action="Index" asp-controller="Home" class="btn btn-primary btn-sm">Back to home</a>